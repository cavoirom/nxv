<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Managing SSH keys with Sekey and Touch ID</title>
    <meta name="description" content="vinh's personal profile" />
    <meta name="author" content="nguyenxuanvinh" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#fdf6e3" />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="stylesheet" href="/index.css" />
    <link rel='alternate' type='application/atom+xml' title='Atom (full content)' href='/blog/atom.xml' />
  </head>

  <body>
    <div id="app"><header><div class="pure-g"><div class="pure-u-1"><ul class="navigator"><li class="navigator__item"><a href="/home" class="navigator__link false">vinh</a></li><li class="navigator__item"><a href="/blog" class="navigator__link navigator__link--active">to be continued</a></li><li class="navigator__item"><a href="https://github.com/cavoirom" class="navigator__link">github</a></li></ul></div></div></header><main id="content" class="content"><div class="blog-entry pure-g"><article class="pure-u-1"><header><h1 class="blog-entry__title">Managing SSH keys with Sekey and Touch ID</h1></header><div class="blog-entry__dates">Created 2022-09-02 Â· Updated 2022-09-02</div><ul class="blog-entry__tags" aria-label="tags"><li class="blog-entry__tag blog-entry__tag__color-4"><a href="/blog/tag/git" aria-label="tag git">git</a></li><li class="blog-entry__tag blog-entry__tag__color-3"><a href="/blog/tag/github" aria-label="tag github">github</a></li><li class="blog-entry__tag blog-entry__tag__color-1"><a href="/blog/tag/macos" aria-label="tag macos">macos</a></li><li class="blog-entry__tag blog-entry__tag__color-5"><a href="/blog/tag/sekey" aria-label="tag sekey">sekey</a></li><li class="blog-entry__tag blog-entry__tag__color-4"><a href="/blog/tag/ssh" aria-label="tag ssh">ssh</a></li></ul><div class="blog-entry__content"><p>I have been using <em><strong>Sekey</strong></em> for more than 4 years, I could say the experience
is better than using SSH private key with passphrase. Sekey will ask for Touch
ID authentication every time I use the private key, it serves great as a second
factor when I work with SSH and git. For example: Everytime I push a commit,
Sekey will ask for permission. If I run a script that modify my git repository,
the Touch ID popup will pop out, the script could not silently modify git
repository without my notice.</p>
<p>Sekey will generate and store SSH keys in Secure Enclave and will not expose
private key. The public key could be export to transfer to remote host, the
Touch ID will be used to authenticate SSH connection instead of private key and
passphrase.</p>
<p>When I first used Sekey, I was confused because Sekey didn't let me see my
private keys, they were stored in Secure Enclave. But it is a feature, we will
not worry of leaking these privated keys.</p>
<h2>Installation</h2>
<p><a href="https://github.com/sekey/sekey#install" target="_blank" rel="nofollow noreferrer noopener">https://github.com/sekey/sekey#install</a></p>
<h2>Authenticating 2 Github accounts</h2>
<p>The problem with 2 Github accounts is they are using the same username and
hostname for SSH connection. We need a way to distinguish between accounts.</p>
<p>We will use <em><strong>git</strong></em> config to make the hostname of those accounts look
different. Then we will config <em><strong>SSH</strong></em> sending identity to remote host.</p>
<h3>Export public keys for SSH config</h3>
<pre><code class="language-bash">sekey --export-key &lt;key-id-1&gt; &gt; ~/.ssh/key_1.pub
sekey --export-key &lt;key-id-2&gt; &gt; ~/.ssh/key_2.pub
</code></pre>
<h3><code>$HOME/.gitconfig</code></h3>
<pre><code>[url &quot;git@github.com-account-1:account-1/&quot;]
    insteadOf = git@github.com:account-1/

[url &quot;git@github.com-account-2:account-2/&quot;]
    insteadOf = git@github.com:account-2/
</code></pre>
<h3><code>$HOME/.ssh/config</code></h3>
<pre><code>Host github.com-account-1
    HostName github.com
    IdentityFile ~/.ssh/key_1.pub
    IdentitiesOnly yes

Host github.com-account-2
    HostName github.com
    IdentityFile ~/.ssh/key_2.pub
    IdentitiesOnly yes
</code></pre>
<h2>Too many failed attempts</h2>
<p>When I was using Macbook Pro 2017, the Touch ID was not so accurate, I got many
failed scans because my fingers was getting wet. In such case, the Touch ID may
locked. I need to lock the computer and use password or Touch ID to unlock, the
Touch ID will happily work again with Sekey.</p>
</div></article></div></main><footer id="footer"><div class="pure-g"><div class="pure-u-1"><hr/><span class="footer__content">Since 2020</span></div></div></footer></div>
    <!-- KEEP SCRIPT AT BOTTOM -->
    <script>
      window.__STATE__ = fetch('/blog/entry/2022/09/02/sekey/index.json').then(response => response.json());
    </script>
    <script src="/index.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/worker.js').then(
            function (registration) {
              // Registration was successful
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            },
            function (err) {
              // registration failed :(
              console.error('ServiceWorker registration failed: ', err);
            }
          );
        });
      }
    </script>
  </body>
</html>
