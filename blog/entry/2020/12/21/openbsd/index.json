{"home":{"title":"vinh","me":{"title":"Hello.","content":"My name is <i><b>vinh</b></i>, I'm a programmer. This is my corner on the Internet. I mostly write about technology related stuffs, my family, some time I also mention my trust in Jesus Christ, my Savior."},"journey":{"title":"journey","years":[{"year":2020,"events":["started this site."]}]},"work":{"title":"companies","years":[{"year":2022,"events":["mesoneer"]},{"year":2021,"events":["UMB"]},{"year":2018,"events":["ubitec"]},{"year":2013,"events":["Axon Active Vietnam"]}]}},"site":{"title":"OpenBSD on DigitalOcean","path":"/blog/entry/2020/12/21/openbsd"},"blog":{"entries":[],"entriesByTag":[],"entry":{"title":"OpenBSD on DigitalOcean","url":"/blog/entry/2020/12/21/openbsd","slug":"openbsd","author":"vinh","preview":"I experiment with OpenBSD as my server OS","created":"2020-12-21T00:52:11.829Z","updated":"2021-07-18T05:16:55.246Z","content":"<p><em>Note: you can apply this guideline for OpenBSD 6.9 and DigitalOcean, as of\n07.2021.</em></p>\n<p>I am moving my internet services from cloud to my controlled servers, to take\nback my data into my hands.</p>\n<p>My servers will run:</p>\n<ul>\n<li>Reverse proxy and HTTP server with Let's Encrypt: host static webside and\nWordpress.</li>\n<li>VPN and Firewall: secure inbound &amp; outbound traffic.</li>\n</ul>\n<p>I recently interested in OpenBSD because of its security focus and strictly\nfree. I had a long time using Linux at work and home, there was nothing to\ncomplain about Linux (especially Gentoo and Archlinux) except the UI is sometime\nnot so nice compare to Windows. Then I got a Macbook and suddenly the UI issues\nwere solved, now the only use case I could think about other OS is running a\nserver, and OpenBSD seems fit my requirement: free, secure, stable and doesn't\nchange so fast.</p>\n<h2>Installation</h2>\n<p>In my use case, I will install OpenBSD on DigitalOcean server. I use the\nsmallest droplet with only $5/month and OpenBSD 6.9.</p>\n<p><strong>Step 1 ·</strong> Prepare the droplet. Because DigitalOcean does not support OpenBSD,\nwe will find a workaround.</p>\n<ul>\n<li>Create a FreeBSD droplet, don't need to care about file system and version\nbecause we will replace them with OpenBSD.</li>\n<li>After created the droplet, power it off.</li>\n<li>Select the droplet &gt; Networking, and write down the Public Network:\n<ul>\n<li>Public IPv4 address.</li>\n<li>Public gateway.</li>\n<li>Subnet mask.</li>\n</ul></li>\n</ul>\n<p><strong>Step 2 ·</strong> Boot the droplet and start OpenBSD installation.</p>\n<ul>\n<li>Open DigitalOcean web console, select the droplet, then go to Recovery &gt; Boot\nfrom Recovery ISO.</li>\n<li>Boot the droplet, and select option 6 in the boot menu for a shell.</li>\n<li>Fetch the OpenBSD Installer:\n<a href=\"https://cdn.openbsd.org/pub/OpenBSD/6.9/amd64/miniroot69.img\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">https://cdn.openbsd.org/pub/OpenBSD/6.9/amd64/miniroot69.img</a></li>\n<li>Write the Installer to the first hard disk:\n<code>dd if=miniroot69.img of=/dev/vda bs=512k</code></li>\n<li>Power off the droplet.</li>\n<li>Go to Recovery &gt; Boot from Hard Drive. Now the Hard Drive already have OpenBSD\nInstaller.</li>\n<li>Power on and the Installer will start.</li>\n</ul>\n<p><strong>Step 3 ·</strong> Take note at some configuration.</p>\n<ul>\n<li>Keyboard layout: default</li>\n<li>File system layout:\n<ul>\n<li><code>/</code> will have 15Gi.</li>\n<li><code>swap</code>: 2Gi.</li>\n<li><code>/home</code>: the rest.</li>\n<li>Adjust those information according to your droplet size.</li>\n</ul></li>\n<li>Hostname: <code>&lt;hostname&gt;</code></li>\n<li>Network configuration:\n<ul>\n<li>Interface: <code>vio0</code></li>\n<li>Tag: <code>vio0:none</code></li>\n<li>IPv4 address: <code>&lt;public-ip-address&gt;</code></li>\n<li>Netmask: <code>&lt;given-netmask&gt;</code></li>\n<li>IPv6 address: <code>none</code></li>\n<li>Default IPv4 route: <code>&lt;given-gateway&gt;</code></li>\n</ul></li>\n<li>File sets:\n<ul>\n<li>bsd</li>\n<li>bsd.rd</li>\n<li>base69.tgz</li>\n<li>man69.tgz</li>\n</ul></li>\n<li>Create a normal user when the intaller ask.</li>\n<li>Choose UTC timezone.</li>\n</ul>\n<p><strong>Step 4 ·</strong> After the installation finished, it's recommended to read\n<a href=\"https://man.openbsd.org/afterboot\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">afterboot</a> after the installation. It helped\nme configure the newly installed host.</p>\n<p>The above step is taken from this post\n<a href=\"https://www.going-flying.com/blog/openbsd-on-digitalocean.html\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">https://www.going-flying.com/blog/openbsd-on-digitalocean.html</a>.</p>\n<h2>Essential tools</h2>\n<h3><code>vim</code></h3>\n<p>Because this is a server, I will install <code>vim</code> with <em>no_x11</em> favor.</p>\n<pre><code>pkg_add vim-*-no_x11\n</code></pre>\n<h3><code>doas</code></h3>\n<p><code>doas</code> could be used as a replacement of <code>sudo</code> in Linux world. It's included in\nthe base, I only need to configure it.</p>\n<p>Because I am the only one log into these servers, I will explicit allow my\nusername has root privilege.</p>\n<pre><code>/etc/doas.conf\n                              \n...\npermit persist &lt;my-username&gt;\n...\n</code></pre>\n<h2>Webserver</h2>\n<p>Running a webserver is one of the main purpose of this server, I will setup a\nWebserver with TLS based on\n<a href=\"https://www.alexander-pluhar.de/openbsd-webserver.html\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">this guideline</a>, using\nbuilt-in <code>relayd</code>, <code>httpd</code>, <code>acme</code> (for Let's Encrypt).</p>\n<p>Because the <code>httpd</code> is running behind <code>relayd</code>, I need to refine the\nconfiguration to keep actual source address instead the address of <code>relayd</code>,\nfollowing <a href=\"https://www.bsdhowto.ch/forwarded.html\" target=\"_blank\" rel=\"nofollow noreferrer noopener\">a post on bsdhowto.ch</a>.</p>\n<hr />\n<p><em>Entry History</em></p>\n<ul>\n<li>2020-12-21 · Created.</li>\n<li>2021-05-12 · Updated the Installation steps.</li>\n<li>2021-07-18 · Update OpenBSD 6.9.</li>\n</ul>\n","tags":["doas","httpd","openbsd","relayd","self-hosted","unix","vim"]}}}